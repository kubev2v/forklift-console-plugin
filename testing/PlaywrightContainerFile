FROM mcr.microsoft.com/playwright:v1.55.0-noble

ARG GIT_COMMIT=unknown
ARG BUILD_DATE=unknown
ARG VERSION=dev

LABEL org.opencontainers.image.created="${BUILD_DATE}" \
      org.opencontainers.image.source="https://github.com/kubev2v/forklift-console-plugin" \
      org.opencontainers.image.version="${VERSION}" \
      org.opencontainers.image.revision="${GIT_COMMIT}" \
      org.opencontainers.image.title="MTV UI Tests" 

ENV LC_ALL=en_US \
    IMAGE_VERSION="${VERSION}" \
    IMAGE_GIT_COMMIT="${GIT_COMMIT}" \
    IMAGE_BUILD_DATE="${BUILD_DATE}"

WORKDIR /test-runner

COPY package.json yarn.lock ./
RUN corepack enable && \
    yarn install --frozen-lockfile --ignore-scripts

COPY . .

RUN chmod +x run-tests.sh && \
    chown -R 1001:0 /test-runner && \
    chmod -R g+w /test-runner

USER 1001

CMD ["./run-tests.sh"]
